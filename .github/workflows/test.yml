name: ğŸ§ª Test MCP-JIRA Setup Scripts

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test-setup-scripts:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ”§ Make scripts executable
      run: chmod +x *.sh
    
    - name: ğŸš€ Test complete setup script
      run: |
        ./setup-mcp-jira.sh TestProject
        echo "âœ… Complete setup script executed successfully"
    
    - name: ğŸ“ Verify project structure
      run: |
        cd TestProject
        echo "ğŸ” Checking created files..."
        test -f README.md && echo "âœ… README.md exists"
        test -f .env.template && echo "âœ… .env.template exists"
        test -f .vscode/mcp.json.template && echo "âœ… mcp.json.template exists"
        test -f configure.sh && echo "âœ… configure.sh exists"
        test -f verify-setup.sh && echo "âœ… verify-setup.sh exists"
        test -f requirements.txt && echo "âœ… requirements.txt exists"
        test -f .gitignore && echo "âœ… .gitignore exists"
        test -d mcp_jira && echo "âœ… mcp_jira/ directory exists"
        test -d docs && echo "âœ… docs/ directory exists"
        test -f mcp_jira/__init__.py && echo "âœ… Python module initialized"
        test -f mcp_jira/__main__.py && echo "âœ… Configuration checker exists"
    
    - name: ğŸ”§ Test configuration script
      run: |
        cd TestProject
        ./configure.sh
        test -f .env && echo "âœ… .env file created"
        test -f .vscode/mcp.json && echo "âœ… mcp.json file created"
    
    - name: âš¡ Test simple setup script
      run: |
        ./simple-setup.sh SimpleTestProject
        echo "âœ… Simple setup script executed successfully"
    
    - name: ğŸ“Š Display test results
      run: |
        echo "ğŸ‰ All tests passed!"
        echo "ğŸ“‹ Setup scripts are working correctly"
        echo "ğŸš€ Repository is ready for production use"

  test-docker-availability:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ³ Test Docker availability
      run: |
        docker --version
        echo "âœ… Docker is available in CI environment"
    
    - name: ğŸ§ª Test MCP-Atlassian container pull
      run: |
        docker pull ghcr.io/sooperset/mcp-atlassian:latest
        echo "âœ… MCP-Atlassian container can be pulled"

  validate-documentation:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ“– Check documentation files
      run: |
        test -f README.md && echo "âœ… Main README exists"
        test -f README-GITHUB.md && echo "âœ… GitHub README exists"
        test -f DEPLOYMENT.md && echo "âœ… Deployment guide exists"
        test -f templates/README.md && echo "âœ… Templates documentation exists"
        echo "ğŸ“š All documentation files are present"
    
    - name: ğŸ” Validate markdown syntax
      uses: DavidAnson/markdownlint-action@v1
      with:
        files: '**/*.md'
        config: |
          {
            "MD013": { "line_length": 120 },
            "MD033": false,
            "MD041": false
          }
